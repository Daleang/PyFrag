---
title: Pyfrag
date: 2019-01-07 17:47:22
---



[Theoretical Chemistry](http://www.chem.vu.nl/en/research/division-theoretical-chemistry/index.asp) – [ACMM](http://www.acmm.nl/) – [Department of Chemistry](http://www.chem.vu.nl/en/index.asp) – [Faculty of Sciences](http://www.few.vu.nl/en/index.asp) – [Vrije Universiteit Amsterdam](http://www.vu.nl/en/index.asp)


-   [Home](https://sunxb05.github.io "Home")
-   [People](/people "People")
    -   [Group Members](/groupmembers "Group Members")
-   [Research](/research "Research")
    -   [Research Projects](/researchprojects "Research Projects")
    -   [Research Tools](/researchtools "Research Tools")
    -   [PyFrag](/pyfrag "PyFrag")
    -   [PyFrag Old](/pyfragold "PyFrag Old")
-   [Publications](/publications "Publications")
    -   [Refereed Publications](/refereedpublications "Refereed Publications")
    -   [Software](/software "Software")
    -   [PhD Theses](/phdtheses "PhD Theses")
-   [Curriculum Vitae](/curriculumvitae "Curriculum Vitae")
    -   [Cronological](/cronological "Cronological")
    -   [Honors](/honors "Honors")
-   [Contact](/contact "Contact")
-   [Forum](http://ec2-52-15-240-84.us-east-2.compute.amazonaws.com "Forum")



## PyFrag

[«  Research](/research "Research")
[PyFrag Old](/pyfragold "PyFrag Old")
[Research Tools  »](/researchtools "Research Tools")

## 1. Introduction to PyFrag

The PyFrag program is a ‘wrap-around’ for the Amsterdam Density Functional (ADF) package and facilitates the extension of the fragment analysis method implemented in ADF along an entire potential energy surfaces. The original version of PyFrag was developed by Willem-Jan van Zeist, Lando P. Wolters, F. Matthias Bickelhaupt, and Célia Fonseca Guerra at the Theoretical Chemistry department at Vrije Universiteit Amsterdam. The new PyFrag program was rewritten by Xiaobo Sun and Thomas Soini using the PLAMS library in the ADF package and has been included in the script collection in ADF 2017 and later version. Compared to the old PyFrag, the new version is more compact and easy to be maintained, expanded and upgraded. Also, due to its high compatibility with other python library tools developed by SCM, such as, PLAMS and QMworks, it can be used as a module in line with these computational chemistry job management tools to streamline a large flow of job. For more information about PLAMS and QMworks, the user can refer to [https://www.scm.com/doc/Scripting/index.html](https://www.scm.com/doc/Scripting/index.html). PyFrag has been mainly used for research in the group of F. M. Bickelhaupt to enable a user-friendly analysis of reaction paths in terms of the Extended Activation Strain model of chemical reactivity(ASM). The following papers give an example how PyFrag can be used in real reaction path analysis[1] and a review of how Activation Strain model can help to resolve diverse chemistry problems[2-4]. For anyone who are interested in the old version of PyFrag or try to report a bug or add more functions to the new version of PyFrag, please visit [https://github.com/sunxb05/backup/tree/master/pyfrag3](https://github.com/sunxb05/backup/tree/master/pyfrag3)

[1] W.-J. van Zeist, C. Fonseca Guerra, F. M. Bickelhaupt, [_J. Comput. Chem._ **2008**, _29_, 312-315](http://dx.doi.org/10.1002/jcc.20786).

[2] I. Fernandez, F. M. Bickelhaupt, [_Chem. Soc. Rev._ **2014**, _43_, 4953-4967](http://dx.doi.org/10.1039/C4CS00055B).

[3] L. P. Wolters, F. M. Bickelhaupt, [_WIRES Comput. Mol. Sci._ **2015**, _5_, 324-343](http://dx.doi.org/10.1002/wcms.1221).

[4] F. M. Bickelhaupt, K. N. Houk [_Angew. Chem._ **2017**, _129_, 10204-10221](http://dx.doi.org/10.1002/ange.201701486); [_Angew. Chem. Int. Ed._ **2017**, _56_, 10070-10086](http://dx.doi.org/10.1002/anie.201701486).

## 2. How to Run PyFrag

PyFrag is a program written in the highly transferable Python programming language. Running it on any given system should pose no problems, provided Python and the ADF package have been installed. PyFrag can be easily run on command line and constructs the necessary ADF jobs from it by reading input statements. By reading or constructing a series of geometry points, a series of ADF fragment-analysis calculations will be performed, the results of which are gathered in a neat text data file. To run PyFrag on command line is much like to run any other python code, you just simply put command like “startpython pyfrag.py pyfrag_job_script”, in which startpython is a wrap-up python version in ADF. All related files generated by ADF will be saved in a working directory, automatically generated by PLAMS.

Preparation of input of PyFrag is easy. PyFrag input can be divided into two parts, as shown by an example below. One part is to set up basic parameters such as how to define two fragments and specify which data should be printed later, etc. A second part is just normal ADF input for a single point calculation. It is the user's own responsibility to set all the right ADF environment variables, so that ADF can run properly. In principle, nothing needs to be changed compared to running a single ADF job. To run it in cluster, for example, with a job management like “Slurm”, one can write a bash script to call PyFrag.

Command line example to run PyFrag:

_startpython pyfrag.py -- ircpath molecule.xyz -- fragment 2 -- fragment 1 3 4 5 6 -- strain 0 -- strain -554.1 -- bondlength 1 6 1.093 -- angle 2 1 6 180 --VDD 2 1 6 -- hirshfeld frag1 -- irrepOI AA -- orbitalenergy frag2 LUMO -- adfinput basis.type=TZ2P -- adfinputfile adfinputfile_

Bash script example to run PyFrag:

_#!/bin/bash_

_#SBATCH -J pyfrag-input_

_#SBATCH -N 1_

_#SBATCH -t 1:00:00_

_#SBATCH --partition=tc5_

_#SBATCH --output=%job.stdout_

_#SBATCH --error=%job.stderr_

_export NSCM=16_

_export SCM-TMPDIR=$TMPDIR_

_startpython PathtoPyfrag/PyFrag.py \_

_--name filename \_

_--ircpath PathtoMolecule/molecule.xyz \_

_--fragment 2 --fragment 1 3 4 5 6 --strain 0 --strain -554.1 \_

_--bondlength 1 6 1.093 \_

_--angle 2 1 6 180 \_

_--VDD 2 1 6 \_

_--hirshfeld frag1 \_

_--irrepOI AA \_

_--irrepOI AAA \_

_--orbitalenergy frag1 HOMO \_

_--orbitalenergy frag2 LUMO \_

_--orbitalenergy AA frag2 5 \_

_--population frag1 HOMO \_

_--population AA frag2 5 \_

_--overlap frag1 HOMO frag2 LUMO \_

_--overlap S frag1 5 AA frag2 4 \_

_--adfinput basis.type=TZ2P --adfinputfile PathtoADFfile/adfinputfile_

## 3.Options and specifications

On a line, everything after a '#' will be ignored, allowing for comments in your inputfile. The data file pyfrag.txt by default will contain, as columns:


• The filenames of the fragment analysis calculations, which are numbered for each step in the calculations.
• The total interaction energy (kcal/mol)
• The Pauli repulsion (kcal/mol)
• The Electrostatic interaction (kcal/mol)
• The Orbital interaction (kcal/mol)

Provide name for the directory, otherwise the directory will be named by PID.

_• -- name filename_

User can also rerun the same calculation to extract more information from the t21 files in the old job, as long as the right path is provided.

_• -- restart path to old job_

_for example:_

_• -- restart /Users/Desktop/plams.13018_

Specify the filename of the LT or IRC output file you wish to analyze, both tape 21 and normal output files can be given. A tape 21 file should have a .t21 extension! Please make sure this is the case. You can specify two output files for an IRC t21 (backward and forward). A text file containing coordinates of an IRC calculation is also acceptable, for example, a text file generated by ADFmovie or Gaussian.

_• -- ircpath filename.xyz_

_• -- irct21 filename.t21_

_• -- lt filename.t21_

These following statements allow you to define the fragments in the analysis. For each of the fragments you supply a list of the numbers for the atoms as they exist on the LT or IRC file. The program will check if they match with the order as in the IRC or LT calculation file. It will print a statement in the error log if it thinks the order is wrong.


_• -- fragment atomnrs_

_for example:_

_• -- fragment 2 -- fragment 1 3 4 5 6_

There are two ways to specify a parameter set for an ADF calculation. Either one can directly set it or one can provide a file containing all information which can be used repeatedly.

_• -- adfinput adfparameter_

_• –adfinputfile adfinputfile_

_for example:_

_• -- adfinput basis.type=TZ2P_

_• -- adfinputfile adfinputfile_

The adfinputfile simply lists all parameters, ADF will need to do any type of calculation. It is similar to a normal ADF input except here all options are connected by “=”. One example file is shown as follows:

_NumericalQuality=VeryGood_

_XC.GGA=OPBE_

_Basis.core=None_

_Charge=0_

_Symmetry=AUTO_

_RELATIVISTIC=Scalar ZORA_

_eprint.sfo=eig ovl_

The following possibilities are optional. Users can choose what information to print after a PyFrag calculation. For instance, one can specify if the strain energy is to be printed for the fragments. Or one can specify the equilibrium energies (in kcal/mol) for the fragments. Beware that the order of this specification should correspond to the order of the fragment definition. This value will then simply be subtracted from the energy of the fragment in question. The program will print the individual strain values for each fragment, plus the total strain and total energy.

_• -- strain fragenergy_

_for example:_

_• -- strain -301.01_
_• -- strain -19.02_

To specify the bond length to be printed for each geometry step, just indicate the atom numbers as they appear in the input order of the total molecule. Specifying bond_diff as well subtracts this value from the actual bond length.


_• -- bondlength atomnr1 atomnr2 bond-diff_

To specify the angle between atoms 1, 2 and 3 to be printed for each geometry step, just indicate the atom numbers as they appear in the input order of the total molecule. Specifying angle_diff as well subtracts this value from the actual angle.


_• -- bangle atomnr1 atomnr2 atomnr3 angle-diff_

The following will print the Hirshfeld charges for the fragment. Note that the order of the fragments as used internally by ADF may differ from what you would expect. Note also that Hirshfeld charges as computed in a fragment analysis differ from those obtained in a ‘normal’ calculation from basic (spherical average-of configurations) ADF atoms like simple single point calculations.

_• -- hirshfeld frag1_


The following prints the VDD charges on the atoms with numbers as given by atomnrs. Note also that VDD charges as computed in a fragment analysis differ from those obtained in a ‘normal’ calculation from basic (spherical average-of configurations) atoms like single point calculation.


_• -- VDD atomnrs_

_for example:_

_• -- VDD 1 2_


Through in the input below, the value of the orbital interaction energy will be printed for certain available irrep. The irrep symbol relates to the symmetry of the whole molecule.

_• -- irrepOI oi irrep_

_for example:_

_• -- irrepOI AA_

The statement below will print the overlap between orbital numbers orb1 on frag1 and orb2 on frag2 in irrep as they appear in the fragment analysis calculation. It can also print the overlap between the HOMO's of fragment one (frag1) and the LUMOs of fragment two (orbitals as found on the fragment calculations). If the orbitals found in this way differ in symmetry, an overlap value of zero is returned. It should be noted that irrep and orbital number refers to each fragment, rather than the whole molecule. Especially, when it comes to frozen core situation, the count of orbital number should not include core orbitals. This rule also applies to the situation of printing orbital energy and population for orbitals of certain fragment.

_• -- overlap frag1 HOMO/LUMO frag2 HOMO/LUMO_

_• -- overlap irrep1 frag1 orb1 irrp2 frag2 orb2_

_for example:_

_• -- overlap frag1 HOMO frag2 LUMO_

_• -- overlap S frag1 5 AA frag2 4_

Through the input below, the orbital energy for a fragment orbital will be printed in available irrep.

_• -- orbitalenergy frag HOMO/LUMO_

_• -- orbitalenergy irrep frag orb_

_for example:_

_• -- orbitalenergy frag1 HOMO_

_• -- orbitalenergy AA frag2 5_

Through the input below, the Mulliken population for a fragment orbital will be printed in available irrep.

_• -- population frag HOMO/LUMO_

_• -- population irrep frag orb_

_for example:_

_• -- population frag1 HOMO_

_• -- population AA frag2 5_


## 4. PyFrag in combination with other programs

The PyFrag program is specially designed to facilitates the study of reaction mechanism in a more efficient and user-friendly way. It automates the process of finding transition states, potential energy surface by using one simple input file. It follows by an activation strain analysis on the energy profile to characterize the feature of the reaction mechanism and gain insights into the overall reaction energies. Moreover, users can have an real-time monitoring of the running process via a webpage which vividly displays the updated data in the form of videos and figures and, if necessary, user can rerun the job immediately from where it stops. In this way, the three respects of computational chemistry–job management, data management and analysis management can all be contained in a framework and thus allow chemists to focus on the interpretation and creation work rather than waste time and energy on the finding and processing of massive data.



#### Popular Links

• [Web of Science](http://apps.webofknowledge.com.vu-nl.idm.oclc.org/WOS_GeneralSearch_input.do?product=WOS&search_mode=GeneralSearch&SID=E5y9i42QJFIPOm1Dj35&preferencesSaved=)•  [NIST Chemistry Webbook](http://webbook.nist.gov/chemistry/)
• [Library](http://cat.ubvu.vu.nl/)
• [VUNET](https://vunet.vu.nl/)

[![StatCounter - Free Web Tracker and Counter](http://c.statcounter.com/t.php?sc_project=232560&java=1&security=&u1=9E3C867994D84F66E1F9FC73747B1C09&sc_random=0.9092635490650225&jg=10&rr=2.1.1.1.1.1.1.1.1&resolution=1920&h=1080&camefrom=http%3A//www.few.vu.nl/%7Ebickel/page-1/group-members/&u=http%3A//www.few.vu.nl/%7Ebickel/page-1/&t=People%20%7C%20Bickelhaupt%20Group%20%7C%20F.%20M.%20Bickelhaupt&rcat=d&rdomo=d&rdomg=10&sc_snum=1&sess=7a9eb4&p=0)](http://www.statcounter.com/)

